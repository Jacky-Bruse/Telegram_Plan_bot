version: '3.8'

services:
  planbot:
    # 使用 Docker Hub 镜像（GitHub Actions 自动构建）
    image: jackybruse/telegram-planbot:latest

    # 本地构建选项（如需本地构建，注释上面的 image，取消注释下面的 build）
    # build: .

    container_name: telegram-planbot
    restart: unless-stopped

    # 挂载数据目录（持久化）
    volumes:
      - ./data:/app/data
      - ./config.json:/app/config.json:ro  # 只读挂载配置文件

    # 用户配置（匹配 Dockerfile 中的 botuser）
    user: "1000:1000"

    # 环境变量（可选，优先级低于 config.json）
    environment:
      - TZ=Asia/Shanghai
      # 如果不使用 config.json，可以通过环境变量配置：
      # - BOT_TOKEN=your_bot_token_here
      # - DB_PATH=/app/data/bot.db
      # - DEFAULT_TZ=Asia/Shanghai
      # - DEFAULT_EVENING=22:00
      # - DEFAULT_MORNING=08:30
      # - LOG_LEVEL=INFO
      # - LOG_FILE=/app/data/bot.log

    # 日志配置
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

    # 资源限制（可选）
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 512M
        reservations:
          cpus: '0.25'
          memory: 256M

# 持久化数据卷
volumes:
  data:
